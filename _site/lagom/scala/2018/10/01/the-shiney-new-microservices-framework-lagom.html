<!DOCTYPE html>
<html>

<head>
  <title>ScalaMill | Custom Software developmemt using Scala, Akka, Playframework, Lagom and Spark</title>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <link href="/css/autumn.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Welcome to ScalaMill blog" />
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Welcome to ScalaMill blog" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

  <script>
  
  $(document).ready(function(){
    $('.sidenav').sidenav();
  });

  </script>

  <!-- <link rel="stylesheet" href="/js/animate.css"> -->
  <!-- <link rel="stylesheet" href="/css/animations.css"> -->


  <!-- <link rel="stylesheet" href="/hljs/styles/atelier-plateu-light.css">
<script src="/hljs/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script> -->

</head>

<body>
    
  <div class  = "navbar-fixed" style ="z-index: 999">
  <div id="nav-bar" class="nav-wrapper" (window:scroll)="onScroll()">
    <nav id="nav" class="white valign-wrapper" style="padding:2.5%">
      <a href="http://localhost:4000" class="brand-logo hide-on-med-and-down" style="margin-top:0.6%;margin-left:10%"><img src="http://localhost:4000/favicon.ico"
          alt="not-found" height = "35" width = "35"></a>
      <a href="http://localhost:4000" class="brand-logo hide-on-med-and-down" style="margin-left:12%;margin-top:0.5%;"><img src="http://localhost:4000/assets/scala-mill.svg"
          alt="not-found" height = "150" width = "150"></a>
      <a href="http://localhost:4000" class="brand-logo hide-on-large-only left" style="margin-top:1%;margin-left:2%"><img src="http://localhost:4000/favicon.ico"
        alt="not-found" height = "30" width = "30"></a>
      <a href="http://localhost:4000" class="brand-logo hide-on-large-only left"><img src="http://localhost:4000/assets/scala-mill.svg" 
        alt="not-found" height = "120" width = "120" style="margin-left:27%;margin-top:6%"></a>
      <a href="#" data-target="mobile-demo" class="sidenav-trigger purple-text" style="left: 80%;"><i class="material-icons" 
        style="font-size:40px">menu</i></a>
      <ul id="nav-mobile" class="left hide-on-med-and-down" style="margin-left: 50%;">
        <li>
          <a href="http://localhost:4000/whoweare.html" (click)="removeDepth()">
            <span>Company</span>
          </a>
        </li>
        <li>
          <a href="http://localhost:4000/services.html" (click)="addDepth()">
            <span>Consulting & Development</span>
          </a>
        </li>
        <li>
          <a href="http://localhost:4000/training.html" (click)="addDepth()">
            <span>Training</span>
          </a>
        </li>
        <li>
          <a href="https://blog.scalamill.com" (click)="addDepth()">
            <span>Blog</span>
          </a>
        </li>
        <li>
          <a href="http://localhost:4000/contactus.html" (click)="addDepth()">
            <span>Contact</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>   
    <ul class="sidenav" id="mobile-demo" style="z-index: 999;padding: 5%; left: 0%;">
      <div class = "divider"></div>
      <li>
        <a href="http://localhost:4000/whoweare.html" (click)="removeDepth()">
          <span>Company</span>
        </a>
      </li>
      <div class = "divider"></div>
      <li>
        <a href="http://localhost:4000/services.html" (click)="addDepth()">
          <span>Consulting & Development</span>
        </a>
      </li>
      <div class = "divider"></div>
      <li>
        <a href="http://localhost:4000/training.html" (click)="addDepth()">
          <span>Training</span>
        </a>
      </li>
      <div class = "divider"></div>
      <li>
        <a href="https://blog.scalamill.com" (click)="addDepth()">
          <span>Blog</span>
        </a>
      </li>
      <div class = "divider"></div>
      <li>
        <a href="http://localhost:4000/contactus.html" (click)="addDepth()">
          <span>Contact</span>
        </a>
      </li>
      <div class = "divider"></div>
    </ul>
  </div>

<div class="hide-on-small-only">
<div id="particles-js"></div>
</div>


<div class="row">
  <div class="col s12">
      <div style="z-index:99">
        <div class="section post-header center" style="padding: 10%;color:aquamarine">
          <h5 class="white-text" style="font-size:35px">
            <em>The Shiney new microservices framework Lagom</em>
            <p class="white-text tags">
              Lagom,scala,akka,play,microservices
            </p>
          </h5>

          <cite class="white-text">
            Last updated on
            <span class="post-meta">
              <span class="post-date">
                1 OCT 2018
              </span>
            </span> by
            <span class="post-meta">
              <span class="post-author">
                ScalaMill LLP
              </span>
              </span>
          </cite>

          <div class="section">
            <div id="share-bar" style="position:relative">

  <div class="share-buttons">
      <a  href="https://www.facebook.com/sharer/sharer.php?u=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Facebook" >
          <i class="fa fa-facebook-official share-button white-text"> facebook</i>
      </a>

      <a  href="https://twitter.com/intent/tweet?text=The Shiney new microservices framework Lagom&url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Twitter" >
          <i class="fa fa-twitter share-button  white-text"> twitter</i>
      </a>

      <a  href="https://plus.google.com/share?url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Google+" >
          <i class="fa fa-google-plus share-button  white-text"> google</i>
      </a>

      <a  href="http://pinterest.com/pin/create/button/?url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Pinterest" >
          <i class="fa fa-pinterest-p share-button  white-text"> pinterest</i>
      </a>

      <a  href="http://www.tumblr.com/share/link?url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Tumblr" >
          <i class="fa fa-tumblr share-button  white-text"> tumblr</i>
      </a>

      <a  href="http://www.reddit.com/submit?url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Reddit" >
          <i class="fa fa-reddit-alien share-button  white-text"> reddit</i>
      </a>

      <a  href="https://www.linkedin.com/shareArticle?mini=true&url=/lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html&title=The Shiney new microservices framework Lagom&summary=&source=scalamill"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on LinkedIn" >
          <i class="fa fa-linkedin share-button  white-text"> linkedin</i>
      </a>

      <a  href="mailto:?subject=The Shiney new microservices framework Lagom&amp;body=Check out this site /lagom/scala/2018/10/01/the-shiney-new-microservices-framework-lagom.html"
          title="Share via Email" >
          <i class="fa fa-envelope share-button  white-text"> email</i>
      </a>
  </div>

</div>

          </div>
        </div>
    </div>

      <div id = "blogpost" class="col s12 xl8 offset-xl2 blogpost" style="padding:3%">
          <h2 id="what-is-lagom-framework">What is Lagom Framework?</h2>

<p><b>Lagom</b> is a Microservices framework built on top of Akka and Play. Lagom provides Scala as well as Java API to build microservices. Like Akka where we focus on writing business logic in Actors rather than focusing on low-level multi-threading logic, Lagom enables us to write microservices without bothering about wiring them.</p>

<h2 id="features-of-lagom-framework">Features of Lagom Framework</h2>
<div id="lists">
<ol>
 	<li>    A Single command builds your supported components and microservices.</li>
 	<li>    Solves business problems instead of wiring services.</li>
 	<li>    Quickly build and hot reload project when source code changes.</li>
 	<li>    As it is built on top of Akka we get all merits of reactive applications i.e Elasticity, Resiliency and Responsiveness.</li>
</ol>
</div>
<h2 id="lagom-development-environment-comprises-of-and-runs-on">Lagom development environment comprises of and runs on</h2>
<div id="lists">
<ol>
 	<li>   Cassandra</li>
 	<li>   Kafka</li>
 	<li>   A service locator</li>
 	<li>   A service gateway</li>
 	<li>   Your Lagom services</li>
</ol>
</div>
<h2 id="below-are-some-rules-for-building-microservices-in-lagom">Below are some rules for building Microservices in Lagom</h2>
<div id="lists">
<ol>
 	<li> Each services owns it's data</li>
 	<li> Lagom uses persistence and event sourcing for managing data</li>
 	<li> Lagom separate the service implementation from its description.</li>
</ol>
</div>
<p>In this post, we will build a minimal Microservices for signing in and signing up a user. First of all, we will create service description interface as shown in below code.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.scalamill.signup.api</span>

<span class="k">import</span> <span class="nn">akka.NotUsed</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.Service.pathCall</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.transport.Method</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.</span><span class="o">{</span><span class="nc">Service</span><span class="o">,</span> <span class="nc">ServiceCall</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.scalamill.persistence.</span><span class="o">{</span><span class="nc">User</span><span class="o">,</span> <span class="nc">UserSignUpDone</span><span class="o">}</span>

<span class="k">trait</span> <span class="nc">SignUpLagomService</span> <span class="k">extends</span> <span class="nc">Service</span> <span class="o">{</span>

  <span class="cm">/**
    * Example: curl http://localhost:9000/api/signin/admin/admin
    * Example: curl -X POST   http://localhost:9000/api/signup/ 
    -H 'content-type: application/json' -d '{"name":"admin", "password":"admin"}'
    */</span>

  <span class="k">def</span> <span class="n">signUp</span><span class="k">:</span> <span class="kt">ServiceCall</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">UserSignUpDone</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">signIn</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">ServiceCall</span><span class="o">[</span><span class="kt">NotUsed</span>, <span class="kt">Boolean</span><span class="o">]</span>

  <span class="k">override</span> <span class="k">final</span> <span class="k">def</span> <span class="n">descriptor</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">import</span> <span class="nn">Service._</span>
    <span class="n">named</span><span class="o">(</span><span class="s">"signup"</span><span class="o">).</span><span class="n">withCalls</span><span class="o">(</span>
      <span class="n">restCall</span><span class="o">(</span><span class="nc">Method</span><span class="o">.</span><span class="nc">POST</span><span class="o">,</span> <span class="s">"/api/signup/"</span><span class="o">,</span> <span class="n">signUp</span><span class="o">),</span>
      <span class="n">pathCall</span><span class="o">(</span><span class="s">"/api/signin/:name/:password"</span><span class="o">,</span> <span class="n">signIn</span> <span class="k">_</span><span class="o">)</span>
    <span class="o">).</span><span class="n">withAutoAcl</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Since we are dealing with sign-in and sign-up, We will need a storage to store user’s data. Lagom uses Event sourcing to store the events which are happened to the entity through its lifetime, which are replayed to bring the object into a consistent state. Thus we will define a persistent entity User to store username and password. Since persistent entity are managed by events and command, let’s create them first.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.scalamill.persistence</span>

<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.persistence.PersistentEntity.ReplyType</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.persistence.</span><span class="o">{</span><span class="nc">AggregateEvent</span><span class="o">,</span> <span class="nc">AggregateEventTag</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">play.api.libs.json.</span><span class="o">{</span><span class="nc">Format</span><span class="o">,</span> <span class="nc">Json</span><span class="o">}</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">CustomCommand</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">SignInCommand</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CustomCommand</span> <span class="k">with</span> <span class="nc">ReplyType</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>

<span class="k">object</span> <span class="nc">SignInCommand</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">format</span><span class="k">:</span> <span class="kt">Format</span><span class="o">[</span><span class="kt">SignInCommand</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Json</span><span class="o">.</span><span class="n">format</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">SignUpCommand</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">CustomCommand</span> <span class="k">with</span> <span class="nc">ReplyType</span><span class="o">[</span><span class="kt">UserSignUpDone</span><span class="o">]</span>

<span class="k">object</span> <span class="nc">SignUpCommand</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">format</span><span class="k">:</span> <span class="kt">Format</span><span class="o">[</span><span class="kt">SignUpCommand</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Json</span><span class="o">.</span><span class="n">format</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">UserSignUpDone</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">UserSignUpDone</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">format</span><span class="k">:</span> <span class="kt">Format</span><span class="o">[</span><span class="kt">UserSignUpDone</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Json</span><span class="o">.</span><span class="n">format</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">SignUpEvent</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nc">Tag</span> <span class="k">=</span> <span class="nc">AggregateEventTag</span><span class="o">[</span><span class="kt">SignUpEvent</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">SignUpEvent</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">,</span> <span class="n">userEntityId</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AggregateEvent</span><span class="o">[</span><span class="kt">SignUpEvent</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">aggregateTag</span><span class="k">:</span> <span class="kt">AggregateEventTag</span><span class="o">[</span><span class="kt">SignUpEvent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">SignUpEvent</span><span class="o">.</span><span class="nc">Tag</span>
<span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">UserState</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">User</span><span class="o">],</span> <span class="n">timeStamp</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">format</span><span class="k">:</span> <span class="kt">Format</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Json</span><span class="o">.</span><span class="n">format</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now create a UserPersistenceEntity which manages the data of users. We can think of a persistent entity as an actor to which we send command and then it persist those event into database. We are using cassandra in our case. This is the place where an entity’s state is managed by events and this is called event sourcing.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.scalamill.persistence</span>

<span class="k">import</span> <span class="nn">java.time.LocalDateTime</span>

<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.persistence._</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.playjson.</span><span class="o">{</span><span class="nc">JsonSerializer</span><span class="o">,</span> <span class="nc">JsonSerializerRegistry</span><span class="o">}</span>

<span class="k">import</span> <span class="nn">scala.collection.immutable.Seq</span>

<span class="k">class</span> <span class="nc">UserPersistenceEntity</span> <span class="k">extends</span> <span class="nc">PersistentEntity</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">type</span> <span class="kt">Command</span> <span class="o">=</span> <span class="nc">CustomCommand</span>
  <span class="k">override</span> <span class="k">type</span> <span class="kt">Event</span> <span class="o">=</span> <span class="nc">SignUpEvent</span>
  <span class="k">override</span> <span class="k">type</span> <span class="kt">State</span> <span class="o">=</span> <span class="nc">UserState</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">initialState</span> <span class="k">=</span> <span class="nc">UserState</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">behavior</span><span class="k">:</span> <span class="kt">Behavior</span> <span class="o">=</span> <span class="nc">Actions</span><span class="o">().</span><span class="n">onCommand</span><span class="o">[</span><span class="kt">SignUpCommand</span>, <span class="kt">UserSignUpDone</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">case</span> <span class="o">(</span><span class="nc">SignUpCommand</span><span class="o">(</span><span class="n">user</span><span class="o">),</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">state</span><span class="o">)</span> <span class="k">=&gt;</span> 
      <span class="n">ctx</span><span class="o">.</span><span class="n">thenPersist</span><span class="o">(</span><span class="nc">SignUpEvent</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">reply</span><span class="o">(</span><span class="nc">UserSignUpDone</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">))</span>
      <span class="o">}</span>
  <span class="o">}.</span><span class="n">onEvent</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="nc">SignUpEvent</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">userEntityId</span><span class="o">),</span> <span class="n">state</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nc">UserState</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">user</span><span class="o">),</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
  <span class="o">}.</span><span class="n">onReadOnlyCommand</span><span class="o">[</span><span class="kt">SignInCommand</span>, <span class="kt">Boolean</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">case</span> <span class="o">(</span><span class="nc">SignInCommand</span><span class="o">(</span><span class="n">user</span><span class="o">),</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">state</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">reply</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">))</span> <span class="o">==</span> <span class="n">user</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">UserPersistenceSerializationRegistry</span> <span class="k">extends</span> <span class="nc">JsonSerializerRegistry</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">serializers</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">JsonSerializer</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">JsonSerializer</span><span class="o">[</span><span class="kt">UserSignUpDone</span><span class="o">],</span>
    <span class="nc">JsonSerializer</span><span class="o">[</span><span class="kt">SignUpCommand</span><span class="o">]</span>
  <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Now our task is to implement service description for signing in and signing up. Look at below code.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.scalamill.signup.impl</span>

<span class="k">import</span> <span class="nn">akka.NotUsed</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.ServiceCall</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.persistence.PersistentEntityRegistry</span>
<span class="k">import</span> <span class="nn">com.scalamill.persistence._</span>
<span class="k">import</span> <span class="nn">com.scalamill.signup.api.SignUpLagomService</span>

<span class="k">class</span> <span class="nc">SignUpLagomServiceImpl</span><span class="o">(</span><span class="n">persistentEntityRegistry</span><span class="k">:</span> <span class="kt">PersistentEntityRegistry</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SignUpLagomService</span> <span class="o">{</span>
  <span class="cm">/**
    * Example: curl http://localhost:9000/api/signin/admin/admin
    * Example: curl -X POST   http://localhost:9000/api/signup/ 
    -H 'content-type: application/json' -d '{"name":"admin", "password":"admin"}'
    */</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">signUp</span><span class="k">:</span> <span class="kt">ServiceCall</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">UserSignUpDone</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ServiceCall</span> <span class="o">{</span>
    <span class="n">user</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">ref</span> <span class="k">=</span> <span class="n">persistentEntityRegistry</span><span class="o">.</span><span class="n">refFor</span><span class="o">[</span><span class="kt">UserPersistenceEntity</span><span class="o">](</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
      <span class="n">ref</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="nc">SignUpCommand</span><span class="o">(</span><span class="n">user</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">signIn</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">ServiceCall</span><span class="o">[</span><span class="kt">NotUsed</span>, <span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ServiceCall</span> <span class="o">{</span>
    <span class="n">request</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">ref</span> <span class="k">=</span> <span class="n">persistentEntityRegistry</span><span class="o">.</span><span class="n">refFor</span><span class="o">[</span><span class="kt">UserPersistenceEntity</span><span class="o">](</span><span class="n">name</span><span class="o">)</span>
      <span class="n">ref</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="nc">SignInCommand</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">password</span><span class="o">)))</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>All are done and we need to bind our service implementation to service description.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.scalamill.signup.impl</span>

<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.ServiceLocator</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.api.ServiceLocator.NoServiceLocator</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.devmode.LagomDevModeComponents</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.persistence.cassandra.CassandraPersistenceComponents</span>
<span class="k">import</span> <span class="nn">com.lightbend.lagom.scaladsl.server.</span><span class="o">{</span><span class="nc">LagomApplication</span><span class="o">,</span> <span class="nc">LagomApplicationContext</span><span class="o">,</span> <span class="nc">LagomApplicationLoader</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.scalamill.persistence.</span><span class="o">{</span><span class="nc">UserPersistenceEntity</span><span class="o">,</span> <span class="nc">UserPersistenceSerializationRegistry</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.scalamill.signup.api.SignUpLagomService</span>
<span class="k">import</span> <span class="nn">play.api.libs.ws.ahc.AhcWSComponents</span>

<span class="k">class</span> <span class="nc">SignUpServiceLoader</span> <span class="k">extends</span> <span class="nc">LagomApplicationLoader</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">load</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">LagomApplicationContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">LagomApplication</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">SignUpLagomApplication</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">override</span> <span class="k">def</span> <span class="n">serviceLocator</span><span class="k">:</span> <span class="kt">ServiceLocator</span> <span class="o">=</span> <span class="nc">NoServiceLocator</span>
      <span class="o">}</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">loadDevMode</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">LagomApplicationContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">LagomApplication</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">SignUpLagomApplication</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="k">with</span> <span class="nc">LagomDevModeComponents</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">describeService</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">readDescriptor</span><span class="o">[</span><span class="kt">SignUpLagomService</span><span class="o">])</span>

<span class="o">}</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">SignUpLagomApplication</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">LagomApplicationContext</span><span class="o">)</span>
  <span class="k">extends</span> <span class="nc">LagomApplication</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="k">with</span> <span class="nc">AhcWSComponents</span> <span class="k">with</span> <span class="nc">CassandraPersistenceComponents</span><span class="o">{</span>

  <span class="k">import</span> <span class="nn">com.softwaremill.macwire._</span>

  <span class="k">override</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">lagomServer</span> <span class="k">=</span> <span class="n">serverFor</span><span class="o">[</span><span class="kt">SignUpLagomService</span><span class="o">](</span><span class="n">wire</span><span class="o">[</span><span class="kt">SignUpLagomServiceImpl</span><span class="o">])</span>

  <span class="k">override</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">jsonSerializerRegistry</span> <span class="k">=</span> <span class="nc">UserPersistenceSerializationRegistry</span>

  <span class="n">persistentEntityRegistry</span><span class="o">.</span><span class="n">register</span><span class="o">(</span><span class="n">wire</span><span class="o">[</span><span class="kt">UserPersistenceEntity</span><span class="o">])</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We are using cassnadra for persisting events and below is the configuration for keyspace. Repo is hosted <a href="https://github.com/scalamill/lagom-signup-microservice">here</a>. Your comments are most welcome.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">play</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">loader</span> <span class="k">=</span> <span class="n">com</span><span class="o">.</span><span class="n">scalamill</span><span class="o">.</span><span class="n">signup</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="nc">SignUpServiceLoader</span>

<span class="k">#</span> <span class="nc">Enable</span> <span class="n">the</span> <span class="n">serializer</span> <span class="k">for</span> <span class="n">akka</span><span class="o">.</span><span class="nc">Done</span> <span class="n">provided</span> <span class="n">in</span> <span class="nc">Akka</span> <span class="mf">2.5</span><span class="o">.</span><span class="mi">8</span><span class="o">+</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">the</span> <span class="n">use</span> <span class="n">of</span> <span class="nc">Java</span> <span class="n">serialization</span><span class="o">.</span>
<span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">serialization</span><span class="o">-</span><span class="n">bindings</span> <span class="o">{</span>
  <span class="s">"akka.Done"</span> <span class="k">=</span> <span class="n">akka</span><span class="o">-</span><span class="n">misc</span>
<span class="o">}</span>

<span class="n">cassandra</span><span class="o">-</span><span class="n">journal</span><span class="o">.</span><span class="n">keyspace</span> <span class="k">=</span> <span class="n">test2</span>
<span class="n">cassandra</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">store</span><span class="o">.</span><span class="n">keyspace</span> <span class="k">=</span> <span class="n">test2</span>
<span class="n">lagom</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">read</span><span class="o">-</span><span class="n">side</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">keyspace</span> <span class="k">=</span> <span class="n">test2</span>
</code></pre></div></div>


        <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = 'https://www-scalamill-com.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      </div>
    </div>

    <div class="section col s12 m12 xl3 l3" style="margin-top:2%">
      <div class="col">
        <div class="card blue-grey lighten-2 white-text followus hide-on-med-and-down" style=" padding:10%">

    <em style = "font-size: 17px" class="white-text">Follow and connect with us on social and corporate Media</em>

    <div class="section"> </div>
    <a href="https://www.linkedin.com/company/scalamill/">
        <i class="fa fa-linkedin share-button white-text"> Linkedin</i></a>

    <a href="https://www.linkedin.com/in/scalamill-software-48a16715b/">
        <i class="fa fa-linkedin share-button white-text"> Linkedin page</i></a>
    <br>
    <a href="https://twitter.com/scalamill">
        <i class="fa fa-twitter share-button white-text"> Twitter</i></a>
</div>

      </div>
    </div>
  </div>

<div class = "section"></div>
<div class = "section"></div>
<div class = "section"></div>

<footer class="page-footer" style="background-color: rgba(13, 33, 99, 0.849)">
    <div class="container col s10 offset-s1" style="font-family:'font-family: 'PT Serif',sans-serif">
        <h6 class="white-text">Follow and connect with us on social and corporate Media</h6>
<div class = "section"></div>
<a href="https://www.linkedin.com/company/scalamill/">
    <i class="fa fa-linkedin share-button white-text"> Linkedin</i></a>

<a href="https://www.linkedin.com/in/scalamill-software-48a16715b/">
    <i class="fa fa-linkedin share-button white-text"> Linkedin page</i></a>
<br>
<a href="https://twitter.com/scalamill">
    <i class="fa fa-twitter share-button white-text"> Twitter</i></a>
      <p class="white-text">
        ScalaMill, now is a startup working towards providing modern software solutions using cutting-edge
          technologies. We are a startup and help startup's as well as big organisation to build thier solutions .
          We welcome clients of every type from small to big enterprises.
        </em>
      </p>
    <br>
    </div>
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">ScalaMill</h5>
          <p class="grey-text text-lighten-4">Developing Software At Pace</p>
        </div>
        <div class="col l4 offset-l2 s12">
          <ul>
            <li>
              <a class="grey-text text-lighten-3" href="https://www.scalamill.com/">Company</a>
            </li>
            <li>
              <a class="grey-text text-lighten-3" href="https://www.scalamill.com/services.html">Consulting and Development</a>
            </li>
            <li>
              <a class="grey-text text-lighten-3" href="https://www.scalamill.com/training.html">Training</a>
            </li>
            <li>
              <a class="grey-text text-lighten-3" href="https://blog.scalamill.com/">blog</a>
            </li>
            <li>
              <a class="grey-text text-lighten-3" href="https://www.scalamill.com/contactus.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
        ScalaMill©2018 Copyright
      </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>           
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>

 $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
  });

  $(document).ready(function () {
    $('.carousel').carousel();
  });


  $('.carousel.carousel-slider').carousel({
    fullWidth: true,
    indicators: false,
    duration: '100'
  });

 setTimeout(autoplay, 5000);
 
 function autoplay() {
    $('.carousel').carousel('next');
    setTimeout(autoplay, 5000);
}

 $(document).ready(function(){
    $('.sidenav').sidenav();
  });
      
      
</script>
<script>
    particlesJS("particles-js", {
  "particles": {
    "number": {
      "value": 100,
      "density": {
        "enable": false,
        "value_area": 800
      }
    },
    "color": {
      "value": "#ffffff"
    },
    "shape": {
      "type": "circle",
      "stroke": {
        "width": 0,
        "color": "blue"
      },
      "polygon": {
        "nb_sides": 5
      },
      "image": {
        "src": "img/github.svg",
        "width": 100,
        "height": 100
      }
    },
    "opacity": {
      "value": 0.5,
      "random": false,
      "anim": {
        "enable": false,
        "speed": 1,
        "opacity_min": 0.1,
        "sync": false
      }
    },
    "size": {
      "value": 3,
      "random": true,
      "anim": {
        "enable": false,
        "speed": 40,
        "size_min": 0.1,
        "sync": false
      }
    },
    "line_linked": {
      "enable": true,
      "distance": 150,
      "color": "#ffffff",
      "opacity": 0.4,
      "width": 1
    },
    "move": {
      "enable": true,
      "speed": 6,
      "direction": "none",
      "random": false,
      "straight": false,
      "out_mode": "out",
      "bounce": false,
      "attract": {
        "enable": false,
        "rotateX": 600,
        "rotateY": 1200
      }
    }
  },
  "interactivity": {
    "detect_on": "canvas",
    "events": {
      "onhover": {
        "enable": true,
        "mode": "grab"
      },
      "onclick": {
        "enable": true,
        "mode": "push"
      },
      "resize": false
    },
    "modes": {
      "grab": {
        "distance": 140,
        "line_linked": {
          "opacity": 1
        }
      },
      "bubble": {
        "distance": 200,
        "size": 40,
        "duration": 2,
        "opacity": 8,
        "speed": 3
      },
      "repulse": {
        "distance": 10,
        "duration": 0.4
      },
      "push": {
        "particles_nb": 4
      },
      "remove": {
        "particles_nb": 2
      }
    }
  },
  "retina_detect": true
});

</script>
<script src="/js/css3-animate-it.js"></script>

</body></html>

